rule_id: CW-010
name: read_then_external_network_egress
description: >
  Detects sequential pattern: data read followed by network egress to an
  external domain within the same trace. Classic exfiltration staging pattern
  adapted for agent tool chains.
severity: critical
category: data_exfiltration
layer: 1
phase: 0
requires_baseline: false
safe_mode_compatible: true

match:
  sequence:
    - step: read_phase
      condition:
        field: tool_category
        equals: "read"
    - step: egress_phase
      condition:
        field: tool_category
        equals: "network"
      semantic_flags:
        is_external: true
  order: sequential
  logic: ALL

response:
  alert: true
  recommended_action: >
    Review the full action trace. Determine what was read and where it was sent.
    Check if the external domain is expected for this agent's purpose.

tags:
  - data_exfiltration
  - exfiltration_staging
